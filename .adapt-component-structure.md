# Adapt Framework Component Structure & Best Practices

## Official Component Structure Reference

This document captures the correct structure for Adapt Framework components based on official components like `adapt-hotgrid` and `adapt-contrib-media`.

## Repository Root Structure

**ALL component files must be at the REPOSITORY ROOT, not in a subdirectory.**

```
component-repository/
│
├── js/                              # JavaScript files
│   ├── adapt-componentName.js       # Main entry file (REQUIRED)
│   ├── componentNameView.js         # View logic (REQUIRED)
│   └── ...other-files.js            # Additional helpers
│
├── templates/                       # Template files
│   └── componentName.hbs            # Handlebars template (NOT JSX!)
│
├── schema/                          # Schema directory
│   ├── component.schema.json        # Component schema (REQUIRED)
│   └── course.schema.json           # Course-level schema (optional)
│
├── less/                            # Styling
│   └── componentName.less           # Component styles
│
├── example/                         # Optional examples
│   └── demo.html                    # Standalone demo
│
├── bower.json                       # Bower package config (REQUIRED)
├── package.json                     # NPM package config (REQUIRED)
├── properties.schema                # Legacy schema (REQUIRED for compatibility)
├── example.json                     # Example configuration (REQUIRED)
├── README.md                        # Documentation (REQUIRED)
├── LICENSE                          # License file
└── .gitignore                       # Git ignore rules
```

## Critical Rules

### 1. File Location
- ❌ **WRONG**: `adapt-componentName/js/file.js`
- ✅ **CORRECT**: `js/file.js` (at repository root)

### 2. Template Format
- ✅ **CORRECT**: JSX/React templates (`.jsx`) for modern Adapt (v5+)
- ⚠️ **LEGACY**: Handlebars templates (`.hbs`) for older versions

### 3. Schema Directory
- ❌ **WRONG**: `properties-schema/`
- ✅ **CORRECT**: `schema/`

### 4. Main Entry File
- **Must be**: `js/adapt-componentName.js`
- **Pattern**:
```javascript
import components from 'core/js/components';
import ComponentNameView from './componentNameView';
import ComponentModel from 'core/js/models/componentModel';

export default components.register('componentName', {
  model: ComponentModel.extend({}),
  view: ComponentNameView
});
```

### 5. View File
- **Filename**: `js/componentNameView.js`
- **Template reference**: Use template name without extension
```javascript
ComponentName.template = 'componentName'; // CRITICAL: NO extension! Not .jsx or .hbs
```

## bower.json Structure

```json
{
  "name": "adapt-componentName",
  "version": "1.0.0",
  "framework": "^5.0.0",
  "homepage": "https://github.com/username/adapt-componentName",
  "displayName": "Component Display Name",
  "component": "componentName",
  "description": "Brief description",
  "main": "/js/adapt-componentName.js",
  "keywords": [
    "adapt-plugin",
    "adapt-component"
  ],
  "license": "GPL-3.0",
  "targetAttribute": "_component"
}
```

## package.json Structure

```json
{
  "name": "adapt-componentName",
  "version": "1.0.0",
  "description": "Brief description",
  "main": "js/adapt-componentName.js",
  "keywords": [
    "adapt-plugin",
    "adapt-component"
  ],
  "author": "Your Name",
  "license": "GPL-3.0",
  "framework": ">=5.0.0"
}
```

## README.md Format

Follow the official format from adapt-hotgrid:

```markdown
# adapt-componentName

**Component Name** is a _presentation component_ which [brief description].

[Longer description of functionality]

## Settings Overview

The attributes listed below are used in _components.json_ to configure...

## Attributes

[**core model attributes**](link): These are inherited by every Adapt component.

### _component (string):
This must be set to: `"componentName"`.

### _classes (string):
CSS class name(s) to be applied...

[etc...]

## Accessibility
[Accessibility information]

## Limitations
[Any limitations]

---

**Author / maintainer:** Name<br>
**Accessibility support:** WAI AA<br>
**RTL support:** Yes/No<br>
**Cross-platform coverage:** Browser list<br>
**Version:** X.Y.Z
```

## Handlebars Template Pattern

```handlebars
{{import_globals}}
<div class="component__inner componentname__inner">

  {{> component this}}

  <div class="component__widget componentname__widget">
    <!-- Component content here -->
    {{#each _items}}
      <div class="componentname__item">
        {{#if _graphic.src}}
          <img src="{{_graphic.src}}" alt="{{alt}}" />
        {{/if}}
      </div>
    {{/each}}
  </div>

</div>
```

## Component View Pattern

```javascript
import ComponentView from 'core/js/views/componentView';

class ComponentNameView extends ComponentView {

  className() {
    return [
      super.className(),
      'componentname'
    ].join(' ');
  }

  preRender() {
    // Setup before render
  }

  postRender() {
    this.setReadyStatus();
    
    if (this.model.get('_setCompletionOn') === 'inview') {
      this.setupInviewCompletion();
    }

    // Initialize component
  }

  remove() {
    // Cleanup
    super.remove();
  }

}

ComponentNameView.template = 'componentName';

export default ComponentNameView;
```

## Schema Structure (schema/component.schema.json)

```json
{
  "$anchor": "componentname-component",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "$merge": {
    "source": {
      "$ref": "component"
    },
    "with": {
      "properties": {
        "_supportedLayout": {
          "type": "string",
          "title": "Supported layout",
          "default": "both",
          "enum": ["full-width", "half-width", "both"],
          "_adapt": {
            "editorOnly": true
          }
        },
        "instruction": {
          "type": "string",
          "title": "Instruction",
          "default": "",
          "_adapt": {
            "translatable": true
          }
        }
        // ... component-specific properties
      }
    }
  }
}
```

## Git Workflow & Releases

### Version Numbering
- **Major (X.0.0)**: Breaking changes, incompatible API changes
- **Minor (0.X.0)**: New features, backwards compatible
- **Patch (0.0.X)**: Bug fixes, backwards compatible

### Release Process (REQUIRED FOR EVERY PUSH)

1. **Make changes and test**
2. **Update version** in bower.json and package.json
3. **Commit changes**:
```bash
git add -A
git commit -m "type: description"
```

4. **Create tag**:
```bash
git tag -a vX.Y.Z -m "Release vX.Y.Z - Description

Changes:
- Change 1
- Change 2
- Change 3"
```

5. **Push to GitHub**:
```bash
git push origin main
git push origin vX.Y.Z
```

### Commit Message Format

Use conventional commits:
- `feat:` - New feature
- `fix:` - Bug fix
- `refactor:` - Code refactoring
- `docs:` - Documentation changes
- `chore:` - Maintenance tasks
- `style:` - Code style changes
- `test:` - Testing changes

**BREAKING CHANGES**: Add `BREAKING CHANGES:` section in commit body

## Common Mistakes to Avoid

1. ❌ Putting component in subdirectory (e.g., `adapt-componentName/js/`)
2. ❌ Using JSX/React templates instead of Handlebars
3. ❌ Using `properties-schema/` instead of `schema/`
4. ❌ Not creating GitHub releases/tags
5. ❌ Including too much documentation (keep only README.md)
6. ❌ Wrong main entry file path in bower.json/package.json
7. ❌ Template extension in template reference (`.hbs` or `.jsx`)
8. ❌ Not following conventional commit format

## Checklist for New Components

- [ ] Files at repository root (not in subdirectory)
- [ ] Handlebars template (`.hbs`)
- [ ] Schema in `schema/` directory
- [ ] Main entry: `js/adapt-componentName.js`
- [ ] View file: `js/componentNameView.js`
- [ ] Component registration with `components.register()`
- [ ] bower.json with correct main path
- [ ] package.json with correct main path
- [ ] properties.schema (legacy)
- [ ] example.json
- [ ] README.md (concise, following official format)
- [ ] LICENSE file
- [ ] .gitignore

## Reference Components

Study these for correct structure:
- **adapt-hotgrid**: https://github.com/cgkineo/adapt-hotgrid
- **adapt-contrib-media**: https://github.com/adaptlearning/adapt-contrib-media
- **adapt-contrib-text**: https://github.com/adaptlearning/adapt-contrib-text

## Key Takeaways

1. **Root level is key** - All component files at repository root
2. **Handlebars not JSX** - Use .hbs templates
3. **Always tag releases** - Every meaningful push needs a version tag
4. **Follow conventions** - Match official component structure exactly
5. **Keep README simple** - Follow adapt-hotgrid format
6. **Use schema/ not properties-schema/** - Standard directory name
7. **Entry point matters** - Must be js/adapt-componentName.js

---

**Last Updated**: 2024-11-07  
**Based On**: adapt-hotgrid, adapt-contrib-media structure  
**For**: Adapt Framework v5+
